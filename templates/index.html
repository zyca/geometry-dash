<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geometry Dash</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div id="errorDisplay" style="position: fixed; top: 0; left: 0; width: 100%; background: rgba(255,0,0,0.9); color: white; z-index: 20000; display: none; padding: 20px; font-family: monospace; word-break: break-all;"></div>
    
    <script>
        // Emergency Level Data
        window.LEVELS_DATA = [
            { name: "Stereo Madness", stars: 1, difficulty: "Easy", seed: 1001, hue: 200, duration: 60, params: { gap: 1.6, complexity: 1 }, platformStyle: 'grid', modeSequence: ['cube', 'ship', 'ufo', 'wave', 'cube_upside_down'] },
            { name: "Back on Track", stars: 3, difficulty: "Normal", seed: 2002, hue: 280, duration: 60, params: { gap: 1.3, complexity: 2 }, platformStyle: 'bricks', modeSequence: ['ship', 'ufo', 'cube', 'wave', 'cube_upside_down'] },
            { name: "Polargeist", stars: 5, difficulty: "Hard", seed: 3003, hue: 120, duration: 60, params: { gap: 1.1, complexity: 3 }, platformStyle: 'glow', modeSequence: ['cube', 'wave', 'ufo', 'ship', 'cube_upside_down'] },
            { name: "Dry Out", stars: 7, difficulty: "Harder", seed: 4004, hue: 30, duration: 60, params: { gap: 0.9, complexity: 4 }, platformStyle: 'metal', modeSequence: ['wave', 'ship', 'cube', 'ufo', 'cube_upside_down'] },
            { name: "Base After Base", stars: 10, difficulty: "Insane", seed: 5005, hue: 0, duration: 60, params: { gap: 0.8, complexity: 5 }, platformStyle: 'checkered', modeSequence: ['ufo', 'cube', 'ship', 'wave', 'cube_upside_down'] }
        ];

        window.onerror = function(msg, url, line) {
            const err = document.getElementById('errorDisplay');
            err.style.display = 'block';
            err.innerHTML = 'FATAL ERROR: ' + msg + '<br>Line: ' + line + '<br>URL: ' + url;
        };
    </script>

    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div id="ui">
            <div id="score">Score: 0</div>
        </div>
        <div id="gameOver" class="hidden">
            <h1>Game Over</h1>
            <button id="restartBtn">Restart</button>
            <button id="menuBtn">Menu</button>
        </div>
        <div id="levelComplete" class="hidden">
            <h1>Level Complete!</h1>
            <div id="levelScore">Score: 0</div>
            <button id="nextLevelBtn">Next Level</button>
            <button id="winMenuBtn">Menu</button>
        </div>
        <div id="levelMenu">
            <h1>Geometry Dash Clone</h1>
            <h2>Select Level</h2>
            <div style="margin-bottom: 20px;">
                <button id="fallbackStartBtn" style="background: orange; color: black;" onclick="startLevel(0)">Emergency Start: Level 1</button>
                <button id="fullscreenBtn" style="background: #444; color: white;">Toggle Fullscreen</button>
            </div>
            <div id="levelList">
                <!-- Level buttons generated by JS -->
            </div>
        </div>
    </div>
    <audio id="bgMusic" loop>
        <!-- Placeholder for music, browser might block autoplay without interaction -->
    </audio>
    <script src="{{ url_for('static', filename='game.js') }}"></script>
</body>
</html>